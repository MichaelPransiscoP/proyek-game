<!DOCTYPE html>
<html>
<head>
  <title>Sudoku Phaser</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>

<script>
const SIZE = 9;
const CELL = 50;
let selected = {row: 0, col: 0};
let cells = [];

let numbers = [
  [5,3,0, 0,7,0, 0,0,0],
  [6,0,0, 1,9,5, 0,0,0],
  [0,9,8, 0,0,0, 0,6,0],

  [8,0,0, 0,6,0, 0,0,3],
  [4,0,0, 8,0,3, 0,0,1],
  [7,0,0, 0,2,0, 0,0,6],

  [0,6,0, 0,0,0, 2,8,0],
  [0,0,0, 4,1,9, 0,0,5],
  [0,0,0, 0,8,0, 0,7,9]
];

const config = {
  type: Phaser.AUTO,
  width: SIZE * CELL,
  height: SIZE * CELL,
  backgroundColor: "#ffffff",
  scene: {
    create: create
  }
};

new Phaser.Game(config);

function create() {
  const scene = this;

  for (let r = 0; r < SIZE; r++) {
    cells[r] = [];
    for (let c = 0; c < SIZE; c++) {
      let x = c * CELL + CELL/2;
      let y = r * CELL + CELL/2;

      let rect = scene.add.rectangle(x, y, CELL-2, CELL-2, 0xf0f0f0)
        .setStrokeStyle(1, 0x000000)
        .setInteractive();

      rect.on("pointerdown", () => {
        selected.row = r;
        selected.col = c;
        highlight();
      });

      let fixed = numbers[r][c] !== 0;

      let text = scene.add.text(x, y, numbers[r][c] || "", {
        fontSize: "20px",
        color: fixed ? "#000" : "#000"
      }).setOrigin(0.5);

      cells[r][c] = {rect, text, fixed};
    }
  }

  highlight();
  refreshColors();

  scene.input.keyboard.on("keydown", (event) => {
    if (cells[selected.row][selected.col].fixed) return;

    let n = parseInt(event.key);

    if (n >= 1 && n <= 9) {
      numbers[selected.row][selected.col] = n;
      cells[selected.row][selected.col].text.setText(n);
      refreshColors();
    }

    if (event.key === "Backspace") {
      numbers[selected.row][selected.col] = 0;
      cells[selected.row][selected.col].text.setText("");
      refreshColors();
    }
  });
}

function highlight() {
  for (let r = 0; r < SIZE; r++) {
    for (let c = 0; c < SIZE; c++) {
      cells[r][c].rect.setFillStyle(0xf0f0f0);
    }
  }
  cells[selected.row][selected.col].rect.setFillStyle(0xffe066);
}

function isValid(row, col, num) {
  if (num === 0) return true;

  // cek baris
  for (let c = 0; c < SIZE; c++) {
    if (c !== col && numbers[row][c] === num) return false;
  }

  // cek kolom
  for (let r = 0; r < SIZE; r++) {
    if (r !== row && numbers[r][col] === num) return false;
  }

  // cek kotak 3x3
  let startRow = Math.floor(row / 3) * 3;
  let startCol = Math.floor(col / 3) * 3;

  for (let r = startRow; r < startRow + 3; r++) {
    for (let c = startCol; c < startCol + 3; c++) {
      if ((r !== row || c !== col) && numbers[r][c] === num) {
        return false;
      }
    }
  }

  return true;
}

function refreshColors() {
  for (let r = 0; r < SIZE; r++) {
    for (let c = 0; c < SIZE; c++) {
      let val = numbers[r][c];

      if (val === 0) {
        cells[r][c].text.setColor("#000");
      } 
      else if (isValid(r, c, val)) {
        cells[r][c].text.setColor("#000");
      } 
      else {
        cells[r][c].text.setColor("#ff0000"); // merah kalau salah
      }
    }
  }
}
</script>

</body>
</html>
